<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Panel de Administración</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='Styles.css') }}">
</head>
<body>
	<div class="barra-superior">
		<div class="menu-icono" onclick="window.location='{{ url_for('index') }}'">⟵</div>
		Panel de Administración
		<div style="margin-left:auto; padding-right:16px;">
			<a href="{{ url_for('logout') }}">Cerrar sesión</a>
		</div>
	</div>

	<div class="container" style="padding-top: 100px;">
		{% with messages = get_flashed_messages(with_categories=true) %}
			{% if messages %}
				<div class="flash-messages">
					{% for category, message in messages %}
						<div class="flash-message flash-{{ category }}">{{ message }}</div>
					{% endfor %}
				</div>
			{% endif %}
		{% endwith %}

		<h2>Categorías</h2>
		<div class="admin-section">
			<form method="POST" action="{{ url_for('admin_categorias_crear') }}" class="admin-form">
				<input type="text" name="nombre" placeholder="Nombre" required>
				<input type="text" name="descripcion" placeholder="Descripción">
				<button type="submit">Crear</button>
			</form>
			<table class="admin-table">
				<thead>
					<tr><th>ID</th><th>Nombre</th><th>Descripción</th><th>Acciones</th></tr>
				</thead>
				<tbody>
					{% for c in categorias %}
					<tr>
						<td>{{ c[0] }}</td>
						<td>
							<form method="POST" action="{{ url_for('admin_categorias_actualizar', categoria_id=c[0]) }}" class="inline-form">
								<input type="text" name="nombre" value="{{ c[1] }}" required>
								<input type="text" name="descripcion" value="{{ c[2] or '' }}">
								<button type="submit">Guardar</button>
							</form>
						</td>
						<td>{{ c[2] or '' }}</td>
						<td>
							<form method="POST" action="{{ url_for('admin_categorias_eliminar', categoria_id=c[0]) }}" onsubmit="return confirm('¿Eliminar categoría?')">
								<button type="submit" class="btn-danger">Eliminar</button>
							</form>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<h2>Productos</h2>
		<div class="admin-section">
			<form method="POST" action="{{ url_for('admin_productos_crear') }}" class="admin-form" enctype="multipart/form-data">
				<input type="text" name="nombre" placeholder="Nombre" required>
				<input type="text" name="descripcion" placeholder="Descripción">
				<input type="number" name="precio" placeholder="Precio" step="0.01" required>
				<select name="categoria">
					<option value="">Sin categoría</option>
					{% for c in categorias %}
					<option value="{{ c[1] }}">{{ c[1] }}</option>
					{% endfor %}
				</select>
				<input type="file" name="imagen_file" accept=".png,.jpg,.jpeg,.webp,.gif">
				<button type="submit">Crear</button>
			</form>
			<table class="admin-table">
				<thead>
					<tr><th>ID</th><th>Nombre</th><th>Descripción</th><th>Precio</th><th>Categoría</th><th>Imagen</th><th>Acciones</th></tr>
				</thead>
				<tbody>
					{% for p in productos %}
					<tr>
						<td>{{ p[0] }}</td>
						<td colspan="5">
						<form method="POST" action="{{ url_for('admin_productos_actualizar', producto_id=p[0]) }}" class="inline-form" enctype="multipart/form-data">
								<input type="text" name="nombre" value="{{ p[1] }}" required>
								<input type="text" name="descripcion" value="{{ p[2] or '' }}">
								<input type="number" name="precio" value="{{ '%.2f' % p[3] }}" step="0.01" required>
							<select name="categoria">
								<option value="">Sin categoría</option>
								{% for c in categorias %}
								<option value="{{ c[1] }}" {% if p[4] == c[1] %}selected{% endif %}>{{ c[1] }}</option>
								{% endfor %}
							</select>
							<input type="file" name="imagen_file" accept=".png,.jpg,.jpeg,.webp,.gif">
								<button type="submit">Guardar</button>
							</form>
						</td>
						<td>
							<form method="POST" action="{{ url_for('admin_productos_eliminar', producto_id=p[0]) }}" onsubmit="return confirm('¿Eliminar producto?')">
								<button type="submit" class="btn-danger">Eliminar</button>
							</form>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<h2>Mozos</h2>
		<div class="admin-section">
			<form method="POST" action="{{ url_for('admin_mozos_crear') }}" class="admin-form">
				<input type="text" name="nombre" placeholder="Nombre" required>
				<input type="email" name="email" placeholder="Email">
				<input type="text" name="telefono" placeholder="Teléfono">
				<label style="display:inline-flex; align-items:center; gap:6px;">
					<input type="checkbox" name="activo" checked> Activo
				</label>
				<button type="submit">Crear</button>
			</form>
			<table class="admin-table">
				<thead>
					<tr><th>ID</th><th>Nombre</th><th>Email</th><th>Teléfono</th><th>Activo</th><th>Acciones</th></tr>
				</thead>
				<tbody>
					{% for m in mozos %}
					<tr>
						<td>{{ m[0] }}</td>
						<td colspan="4">
							<form method="POST" action="{{ url_for('admin_mozos_actualizar', mozo_id=m[0]) }}" class="inline-form">
								<input type="text" name="nombre" value="{{ m[1] }}" required>
								<input type="email" name="email" value="{{ m[2] or '' }}">
								<input type="text" name="telefono" value="{{ m[3] or '' }}">
								<label style="display:inline-flex; align-items:center; gap:6px;">
									<input type="checkbox" name="activo" {% if m[4] %}checked{% endif %}> Activo
								</label>
								<button type="submit">Guardar</button>
							</form>
						</td>
						<td>
							<form method="POST" action="{{ url_for('admin_mozos_eliminar', mozo_id=m[0]) }}" onsubmit="return confirm('¿Eliminar mozo?')">
								<button type="submit" class="btn-danger">Eliminar</button>
							</form>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</body>
</html>


